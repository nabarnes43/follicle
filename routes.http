### ==============================================
### FOLLICLE API TESTING
### ==============================================
###
### Test your API routes with real data
### Make sure dev server is running: npm run dev
###
### ==============================================

@baseUrl = http://localhost:3000
@userId = MzCTihlddchzDsiVoAjcHbxGaRt1
@follicleId = PR-M-M-C-N
@productId = 100_pure_burdock_and_neem_healthy_scalp_conditioner

### IMPORTANT: Get your auth token first
### 1. Open browser console on your app
### 2. Copy the token and paste it below
### const { getAuth } = await import('firebase/auth')
### const token = await getAuth().currentUser.getIdToken()
### console.log(token)


@authToken = eyJhbGciOiJSUzI1NiIsImtpZCI6IjdjNzQ5NTFmNjBhMDE0NzE3ZjFlMzA4ZDZiMjgwZjQ4ZjFlODhmZGEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vZm9sbGljbGUtOTBlYTgiLCJhdWQiOiJmb2xsaWNsZS05MGVhOCIsImF1dGhfdGltZSI6MTc2MzI0MDY4MywidXNlcl9pZCI6IkYyV1hyb2w0V0lPRkVUZUdENmFLME1kYXZINTIiLCJzdWIiOiJGMldYcm9sNFdJT0ZFVGVHRDZhSzBNZGF2SDUyIiwiaWF0IjoxNzY0Mzg0MTg5LCJleHAiOjE3NjQzODc3ODksImVtYWlsIjoibmFzaXIuYmFybmVzQG1vcmVob3VzZS5lZHUiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZW1haWwiOlsibmFzaXIuYmFybmVzQG1vcmVob3VzZS5lZHUiXX0sInNpZ25faW5fcHJvdmlkZXIiOiJwYXNzd29yZCJ9fQ.KOOWVa4B_pYCjIQpBrjMf2d-fjylXvyZi_gOl_pFOjhTC2pdkkwQs1cjZVG22yaS9wsWzhuLS_Sl7EowJqfqrI1pNnMBZa9BET0b-vUT-5YTOOKpFoSv8fgdHmprVB_qSKPKzLGW35PfHz-21k1nLgm9RCAEqA42kN_m4odKJ-XhLb2HT0aUPCdvHj6XisrknxtNvHFJ_bnPxv8HiskSYrLlCUJRctyGgfreFruACIzBx3PefBN2C8AP60ikRhDfoEQXtW6nVbwb4NvohJQYndxH_OdwpFZgvtDZuc--eDbx3tof9VhHVp9GvGv1t4y344IOlfM5pkfQZZVf1GIASA

### ==============================================
### PRODUCTS API
### ==============================================

### Get all products (with server cache)
GET {{baseUrl}}/api/products

### ==============================================
### PRODUCT INTERACTIONS API
### ==============================================

### Create LIKE interaction
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "like"
}

### Create DISLIKE interaction (removes like)
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "dislike"
}

### Create SAVE interaction
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "save"
}

### Create ROUTINE interaction
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "routine"
}

### Create REROLL interaction
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "reroll"
}

### Create VIEW interaction (allows multiple)
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "view"
}

### Delete LIKE interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/like
Authorization: Bearer {{authToken}}

### Delete DISLIKE interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/dislike
Authorization: Bearer {{authToken}}

### Delete SAVE interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/save
Authorization: Bearer {{authToken}}

### Delete ROUTINE interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/routine
Authorization: Bearer {{authToken}}

### Delete REROLL interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/reroll
Authorization: Bearer {{authToken}}

### Test missing field (should return 400)
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "type": "like"
}

### Test invalid type (should return 400)
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "invalid"
}

### Test duplicate interaction (should return 409)
### First run "Create LIKE" above, then run this
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "like"
}

### ==============================================
### ROUTINES API
### ==============================================

@routineId = iGdBbXfyZ3xS5HZwR82X

### Get all routines for a user
GET {{baseUrl}}/api/routines?userId={{userId}}

### Get single routine (public or owned)
GET {{baseUrl}}/api/routines/{{routineId}}?userId={{userId}}

### Get single PUBLIC routine (no userId needed)
GET {{baseUrl}}/api/routines/{{routineId}}

### Create new routine
POST {{baseUrl}}/api/routines
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "follicle_id": "{{follicleId}}",
  "name": "Test Moisture Routine",
  "description": "My test routine for API testing",
  "frequency": {
    "interval": 1,
    "unit": "week"
  },
  "steps": [
    {
      "order": 1,
      "step_name": "Shampoo",
      "products": [
        {
          "product_id": "{{productId}}",
          "amount": "Dime-sized"
        }
      ],
      "frequency": {
        "interval": 1,
        "unit": "week"
      },
      "technique": "Massage into scalp",
      "notes": "Focus on roots"
    }
  ],
  "is_public": true
}

### Update routine
PUT {{baseUrl}}/api/routines/{{routineId}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "name": "Updated Moisture Routine",
  "description": "Updated description",
  "is_public": false
}

### Delete routine (soft delete)
DELETE {{baseUrl}}/api/routines/{{routineId}}
Content-Type: application/json

{
  "userId": "{{userId}}"
}

### Test missing userId (should return 400)
GET {{baseUrl}}/api/routines

### Test unauthorized update (wrong userId - should return 403)
PUT {{baseUrl}}/api/routines/{{routineId}}
Content-Type: application/json

{
  "user_id": "wrong_user_id",
  "name": "Hacked Routine"
}

### Test viewing private routine without auth (should return 403)
GET {{baseUrl}}/api/routines/private_routine_id

### ==============================================
### ROUTINE INTERACTIONS API
### ==============================================

### Create LIKE interaction for routine
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "like"
}

### Create DISLIKE interaction for routine (removes like)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "dislike"
}

### Create SAVE interaction for routine
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "save"
}

### Create ADAPT interaction for routine (strongest signal)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "adapt"
}

### Create VIEW interaction for routine (allows multiple)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "view"
}

### Delete LIKE interaction from routine
DELETE {{baseUrl}}/api/interactions/routines/{{routineId}}/like
Authorization: Bearer {{authToken}}

### Delete DISLIKE interaction from routine
DELETE {{baseUrl}}/api/interactions/routines/{{routineId}}/dislike
Authorization: Bearer {{authToken}}

### Delete SAVE interaction from routine
DELETE {{baseUrl}}/api/interactions/routines/{{routineId}}/save
Authorization: Bearer {{authToken}}

### Delete ADAPT interaction from routine
DELETE {{baseUrl}}/api/interactions/routines/{{routineId}}/adapt
Authorization: Bearer {{authToken}}

### Test missing field (should return 400)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "type": "like"
}

### Test invalid type (should return 400)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "invalid"
}

### Test duplicate interaction (should return 409)
### First run "Create LIKE" above, then run this
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "like"
}

### ==============================================
### INGREDIENT INTERACTIONS API
### ==============================================

@ingredientId = glycerin

### Get all ingredients
GET {{baseUrl}}/api/ingredients

### Create LIKE interaction for ingredient
POST {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/like
Authorization: Bearer {{authToken}}

### Create DISLIKE interaction for ingredient (removes like)
POST {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/dislike
Authorization: Bearer {{authToken}}

### Create AVOID interaction for ingredient
POST {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/avoid
Authorization: Bearer {{authToken}}

### Create ALLERGIC interaction for ingredient
POST {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/allergic
Authorization: Bearer {{authToken}}

### Create VIEW interaction for ingredient (allows multiple)
POST {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/view
Authorization: Bearer {{authToken}}

### Delete LIKE interaction from ingredient
DELETE {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/like
Authorization: Bearer {{authToken}}

### Delete DISLIKE interaction from ingredient
DELETE {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/dislike
Authorization: Bearer {{authToken}}

### Delete AVOID interaction from ingredient
DELETE {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/avoid
Authorization: Bearer {{authToken}}

### Delete ALLERGIC interaction from ingredient
DELETE {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/allergic
Authorization: Bearer {{authToken}}

### Test invalid type (should return 400)
POST {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/invalid
Authorization: Bearer {{authToken}}

### Test duplicate interaction (should return 409)
### First run "Create LIKE" above, then run this again
POST {{baseUrl}}/api/interactions/ingredients/{{ingredientId}}/like
Authorization: Bearer {{authToken}}

### Test delete non-existent interaction (should return 404)
DELETE {{baseUrl}}/api/interactions/ingredients/nonexistent_ingredient/like
Authorization: Bearer {{authToken}}

### ==============================================
### ACCESS CODE API
### ==============================================

### Validate access code (success)
POST {{baseUrl}}/api/validate-code
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "code": "FOLLICLE-ADEN"
}

### Test missing code (should return 400)
POST {{baseUrl}}/api/validate-code
Content-Type: application/json
Authorization: Bearer {{authToken}}

{}

### Test invalid code (should return 400)
POST {{baseUrl}}/api/validate-code
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "code": "INVALID-CODE"
}

### Test without auth (should return 401)
POST {{baseUrl}}/api/validate-code
Content-Type: application/json

{
  "code": "FOLLICLE-XXXX"
}

### ==============================================
### NOTES
### ==============================================
###
### Expected Responses:
### - 201: Created successfully
### - 200: Deleted successfully  
### - 400: Bad request (missing/invalid data)
### - 404: Not found
### - 409: Conflict (duplicate)
### - 500: Server error
###
### After each test, check Firestore console:
### - product_interactions/ collection
### - users/{userId}/likedProducts, dislikedProducts, savedProducts
###
### ==============================================
