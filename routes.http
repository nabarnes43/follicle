### ==============================================
### FOLLICLE API TESTING
### ==============================================
###
### Test your API routes with real data
### Make sure dev server is running: npm run dev
###
### ==============================================

@baseUrl = http://localhost:3000
@userId = MzCTihlddchzDsiVoAjcHbxGaRt1
@follicleId = PR-M-M-C-N
@productId = 100_pure_burdock_and_neem_healthy_scalp_conditioner

### IMPORTANT: Get your auth token first
### 1. Open browser console on your app
### 2. Run: firebase.auth().currentUser.getIdToken().then(console.log)
### 3. Copy the token and paste it below
@authToken = eyJhbGciOiJSUzI1NiIsImtpZCI6IjU0NTEzMjA5OWFkNmJmNjEzODJiNmI0Y2RlOWEyZGZlZDhjYjMwZjAiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vZm9sbGljbGUtOTBlYTgiLCJhdWQiOiJmb2xsaWNsZS05MGVhOCIsImF1dGhfdGltZSI6MTc2MDk5NzU1MiwidXNlcl9pZCI6Ik16Q1RpaGxkZGNoekRzaVZvQWpjSGJ4R2FSdDEiLCJzdWIiOiJNekNUaWhsZGRjaHpEc2lWb0FqY0hieEdhUnQxIiwiaWF0IjoxNzYyNTY3NjgwLCJleHAiOjE3NjI1NzEyODAsImVtYWlsIjoibmFiYXJuZXM0M0BnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiZmlyZWJhc2UiOnsiaWRlbnRpdGllcyI6eyJnb29nbGUuY29tIjpbIjEwNDk3OTM0NzE5MjYxNjgyOTA0NSJdLCJlbWFpbCI6WyJuYWJhcm5lczQzQGdtYWlsLmNvbSJdfSwic2lnbl9pbl9wcm92aWRlciI6Imdvb2dsZS5jb20ifX0.KaTPk02BkNHqE9OrPz3aPOi_n3FXMQyvdWD8YlrYuwWP-Vg9qkwSP3YnUBmWTtrYj0eGwfbXXpzVv2LSglmHlBTKDWlpySMlZhwCLvm0uMNy9qh8mWeNRx7gZqmdfbZwEIaHRf6WPYDSbq12LUIV1bmZvuZ86pIN_ul3LMU_JtswAp2mXiLV7U5Z1q4bCT675zTwB62J49nT_1lGjz_wQtMPSKrL4PpOSCmZ90BVef0Ck5sRBHxbW4NxK3Or9YHBSPx1AAhB5GAJzWBbIxBY8BtrUszFFmOS8EF-YRL2UThfapwR5imb9CxxGegj-orXCWJPyZWhxIJ-Ocu4pklMbg

### ==============================================
### PRODUCTS API
### ==============================================

### Get all products (with server cache)
GET {{baseUrl}}/api/products

### ==============================================
### PRODUCT INTERACTIONS API
### ==============================================

### Create LIKE interaction
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "like"
}

### Create DISLIKE interaction (removes like)
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "dislike"
}

### Create SAVE interaction
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "save"
}

### Create ROUTINE interaction
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "routine"
}

### Create REROLL interaction
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "reroll"
}

### Create VIEW interaction (allows multiple)
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "view"
}

### Delete LIKE interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/like
Authorization: Bearer {{authToken}}

### Delete DISLIKE interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/dislike
Authorization: Bearer {{authToken}}

### Delete SAVE interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/save
Authorization: Bearer {{authToken}}

### Delete ROUTINE interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/routine
Authorization: Bearer {{authToken}}

### Delete REROLL interaction
DELETE {{baseUrl}}/api/interactions/products/{{productId}}/reroll
Authorization: Bearer {{authToken}}

### Test missing field (should return 400)
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "type": "like"
}

### Test invalid type (should return 400)
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "invalid"
}

### Test duplicate interaction (should return 409)
### First run "Create LIKE" above, then run this
POST {{baseUrl}}/api/interactions/products
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "productId": "{{productId}}",
  "follicleId": "{{follicleId}}",
  "type": "like"
}

### ==============================================
### ROUTINES API
### ==============================================

@routineId = iGdBbXfyZ3xS5HZwR82X

### Get all routines for a user
GET {{baseUrl}}/api/routines?userId={{userId}}

### Get single routine (public or owned)
GET {{baseUrl}}/api/routines/{{routineId}}?userId={{userId}}

### Get single PUBLIC routine (no userId needed)
GET {{baseUrl}}/api/routines/{{routineId}}

### Create new routine
POST {{baseUrl}}/api/routines
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "follicle_id": "{{follicleId}}",
  "name": "Test Moisture Routine",
  "description": "My test routine for API testing",
  "frequency": {
    "interval": 1,
    "unit": "week"
  },
  "steps": [
    {
      "order": 1,
      "step_name": "Shampoo",
      "products": [
        {
          "product_id": "{{productId}}",
          "amount": "Dime-sized"
        }
      ],
      "frequency": {
        "interval": 1,
        "unit": "week"
      },
      "technique": "Massage into scalp",
      "notes": "Focus on roots"
    }
  ],
  "is_public": true
}

### Update routine
PUT {{baseUrl}}/api/routines/{{routineId}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "name": "Updated Moisture Routine",
  "description": "Updated description",
  "is_public": false
}

### Delete routine (soft delete)
DELETE {{baseUrl}}/api/routines/{{routineId}}
Content-Type: application/json

{
  "userId": "{{userId}}"
}

### Test missing userId (should return 400)
GET {{baseUrl}}/api/routines

### Test unauthorized update (wrong userId - should return 403)
PUT {{baseUrl}}/api/routines/{{routineId}}
Content-Type: application/json

{
  "user_id": "wrong_user_id",
  "name": "Hacked Routine"
}

### Test viewing private routine without auth (should return 403)
GET {{baseUrl}}/api/routines/private_routine_id

### ==============================================
### ROUTINE INTERACTIONS API
### ==============================================

### Create LIKE interaction for routine
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "like"
}

### Create DISLIKE interaction for routine (removes like)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "dislike"
}

### Create SAVE interaction for routine
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "save"
}

### Create ADAPT interaction for routine (strongest signal)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "adapt"
}

### Create VIEW interaction for routine (allows multiple)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "view"
}

### Delete LIKE interaction from routine
DELETE {{baseUrl}}/api/interactions/routines/{{routineId}}/like
Authorization: Bearer {{authToken}}

### Delete DISLIKE interaction from routine
DELETE {{baseUrl}}/api/interactions/routines/{{routineId}}/dislike
Authorization: Bearer {{authToken}}

### Delete SAVE interaction from routine
DELETE {{baseUrl}}/api/interactions/routines/{{routineId}}/save
Authorization: Bearer {{authToken}}

### Delete ADAPT interaction from routine
DELETE {{baseUrl}}/api/interactions/routines/{{routineId}}/adapt
Authorization: Bearer {{authToken}}

### Test missing field (should return 400)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "type": "like"
}

### Test invalid type (should return 400)
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "invalid"
}

### Test duplicate interaction (should return 409)
### First run "Create LIKE" above, then run this
POST {{baseUrl}}/api/interactions/routines
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "routineId": "{{routineId}}",
  "follicleId": "{{follicleId}}",
  "type": "like"
}

### ==============================================
### NOTES
### ==============================================
###
### Expected Responses:
### - 201: Created successfully
### - 200: Deleted successfully  
### - 400: Bad request (missing/invalid data)
### - 404: Not found
### - 409: Conflict (duplicate)
### - 500: Server error
###
### After each test, check Firestore console:
### - product_interactions/ collection
### - users/{userId}/likedProducts, dislikedProducts, savedProducts
###
### ==============================================
